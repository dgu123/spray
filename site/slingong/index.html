<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia at Apr 29, 2013
 | Rendered using Apache Maven Fluido Skin 1.3.0
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="Date-Revision-yyyymmdd" content="20130429" />
    <meta http-equiv="Content-Language" content="en" />
    <title>SlingOnG - 
	
	SlingOnG</title>
    <link rel="stylesheet" href="./css/apache-maven-fluido-1.3.0.min.css" />
    <link rel="stylesheet" href="./css/site.css" />
    <link rel="stylesheet" href="./css/print.css" media="print" />

      
    <script type="text/javascript" src="./js/apache-maven-fluido-1.3.0.min.js"></script>

    
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />        </head>
        <body class="topBarDisabled">
          
        
    
        <div class="container-fluid">
          <div id="banner">
        <div class="pull-left">
                                <div id="bannerLeft">
                <h2>SlingOnG</h2>
                </div>
                      </div>
        <div class="pull-right">                  <a href="http://newmainsoftech.com" id="bannerRight" title="NewMain Softech">
                                                                                                <img src="images/WebLogo1.png"  alt="NewMain Softech" width="55px"/>
                </a>
      </div>
        <div class="clear"><hr/></div>
      </div>

      <div id="breadcrumbs">
        <ul class="breadcrumb">
                
            
                  <li id="publishDate">Last Published: 2013-04-29</li>
                  <li class="divider">|</li> <li id="projectVersion">Version: 2.0.0-SNAPSHOT</li>
                      
                
            
      
                                              
    <li class="pull-right">              <a href="" title="SlingOnG">
        SlingOnG</a>
  </li>

        <li class="divider pull-right">|</li>
      
    <li class="pull-right">              <a href="../" title="Spray">
        Spray</a>
  </li>

                        </ul>
      </div>

            
      <div class="row-fluid">
        <div id="leftColumn" class="span3">
          <div class="well sidebar-nav">
                
            
                <ul class="nav nav-list">
                    <li class="nav-header">Parent Project</li>
                                
      <li>
    
                          <a href="../index.html" title="Spray">
          <i class="none"></i>
        Spray</a>
            </li>
                              <li class="nav-header">Project Documentation</li>
                                                                                                                                                                                                                                                                                                                                                        
      <li>
    
                          <a href="project-info.html" title="Project Information">
          <i class="icon-chevron-down"></i>
        Project Information</a>
                    <ul class="nav nav-list">
                      
      <li class="active">
    
            <a href="#"><i class="none"></i>About</a>
          </li>
                      
      <li>
    
                          <a href="team-list.html" title="Project Team">
          <i class="none"></i>
        Project Team</a>
            </li>
                      
      <li>
    
                          <a href="dependency-info.html" title="Dependency Information">
          <i class="none"></i>
        Dependency Information</a>
            </li>
                      
      <li>
    
                          <a href="dependency-management.html" title="Dependency Management">
          <i class="none"></i>
        Dependency Management</a>
            </li>
                      
      <li>
    
                          <a href="plugins.html" title="Project Plugins">
          <i class="none"></i>
        Project Plugins</a>
            </li>
                      
      <li>
    
                          <a href="integration.html" title="Continuous Integration">
          <i class="none"></i>
        Continuous Integration</a>
            </li>
                      
      <li>
    
                          <a href="issue-tracking.html" title="Issue Tracking">
          <i class="none"></i>
        Issue Tracking</a>
            </li>
                      
      <li>
    
                          <a href="source-repository.html" title="Source Repository">
          <i class="none"></i>
        Source Repository</a>
            </li>
                      
      <li>
    
                          <a href="dependency-convergence.html" title="Dependency Convergence">
          <i class="none"></i>
        Dependency Convergence</a>
            </li>
                      
      <li>
    
                          <a href="license.html" title="Project License">
          <i class="none"></i>
        Project License</a>
            </li>
                      
      <li>
    
                          <a href="plugin-management.html" title="Plugin Management">
          <i class="none"></i>
        Plugin Management</a>
            </li>
                      
      <li>
    
                          <a href="distribution-management.html" title="Distribution Management">
          <i class="none"></i>
        Distribution Management</a>
            </li>
                      
      <li>
    
                          <a href="project-summary.html" title="Project Summary">
          <i class="none"></i>
        Project Summary</a>
            </li>
                      
      <li>
    
                          <a href="mail-lists.html" title="Mailing Lists">
          <i class="none"></i>
        Mailing Lists</a>
            </li>
                      
      <li>
    
                          <a href="dependencies.html" title="Dependencies">
          <i class="none"></i>
        Dependencies</a>
            </li>
              </ul>
        </li>
                                                                                      
      <li>
    
                          <a href="project-reports.html" title="Project Reports">
          <i class="icon-chevron-right"></i>
        Project Reports</a>
                  </li>
            </ul>
                
            
                
          <hr class="divider" />

           <div id="poweredBy">
                            <div class="clear"></div>
                            <div class="clear"></div>
                            <div class="clear"></div>
                             <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy">
        <img class="builtBy" alt="Built by Maven" src="./images/logos/maven-feather.png" />
      </a>
                  </div>
          </div>
        </div>
        
                
        <div id="bodyColumn"  class="span9" >
                                  
            <!-- Copyright (C) 2011-2013 NewMain Softech

    Licensed under the Apache License, Version 2.0 (the "License");
    you may not use this file except in compliance with the License.
    You may obtain a copy of the License at

        http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing, software
    distributed under the License is distributed on an "AS IS" BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND,
    either express or implied. See the License for the specific language
    governing permissions and limitations under the License. -->


<div class="section"><div class="section"><h3>SlingOnG<a name="SlingOnG"></a></h3>
<p><div class="section"><h4>About<a name="About"></a></h4>
The SlingOnG is a transaction manager (an implementation of Spring's PlatformTransactionManager SPI 
(Service Provider Interface) for the platform of <a class="externalLink" href="https://sites.google.com/site/slim3appengine/slim3-datastore">Slim3 Datastore</a> &amp; Spring on GAE/J.<br />
<br />
In order for web app on GAE/J to assure strong data consistency through requests, as the AppEngine's <a class="externalLink" href="https://developers.google.com/appengine/docs/java/datastore/structuring_for_strong_consistency">&quot;Structuring Data for Strong Consistency&quot;</a> page states, it must be done by the transaction.<br />
Slim3's Datastore supports global transaction over multiple entity groups (although GAE/J's Datastore 
now supports transaction over upto 5 entity groups but historically only one) and supports various 
relationships between entities upto many-to-many bidirectional relationship. Such flexibilities what Slim3 
Datastore provides onto GAE/J can bring safe feeling to developer's mind even for the case of unplanned 
future extension of data model of web app. <br />
Spring's transaction manager can release developer from cumbersome of managing transaction. <br />
Hence, hoping that SlingOnG's <a href="apidocs/com/newmainsoftech/spray/slingong/datastore/Slim3PlatformTransactionManager.html"><tt>Slim3PlatformTransactionManger</tt></a> bridging Spring's transaction manager and 
Slim3 Datastore can ease some degree in your coding web app on GAE/J platform.
</p>
<p></div><div class="section"><h4>Usage guide<a name="Usage_guide"></a></h4>
Slim3's <tt>Datastore.beginTransaction</tt> method and <tt>GlobalTransaction.commit</tt> method are 
automatically executed at beginning and end of each transaction by SlingOnG's 
<tt>Slim3PlatformTransactionManger</tt> as Spring Transaction support, thereby what needs to be 
basically done in your code is:
</p><ol style="list-style-type: decimal">
	<li>Annotate method with the <tt>@Transactional</tt> annotation of Spring Transaction.
	</li>
	<li>In the code flow started by the method annotated with the <tt>@Transactional</tt> annotation:
		<ol style="list-style-type: decimal">
			<li>Get current Slim3's <tt>GlobalTransaction</tt> object via <a class="externalLink" href="https://slim3.googlecode.com/svn/trunk/slim3/javadoc/org/slim3/datastore/DatastoreDelegate.html#getCurrentGlobalTransaction%28%29"><tt>DatastoreDelegate.getCurrentGlobalTransaction</tt></a> method (or <a class="externalLink" href="https://slim3.googlecode.com/svn/trunk/slim3/javadoc/org/slim3/datastore/Datastore.html#getCurrentGlobalTransaction%28%29"><tt>Datastore.getCurrentGlobalTransaction</tt></a> method.)
			</li>
			<li>Perform data model operation(s) such as put, delete, and/or query on 
				the <tt>GlobalTransaction</tt> object.
			</li>
		</ol>
	</li>
</ol>
Note: The next tip at the <a class="externalLink" href="https://sites.google.com/site/slim3appengine/slim3-datastore/transactions/uses-for-transactions">&quot;Uses For Transactions&quot; page</a> in Slim3 web site is still valid even with SlingOnG:
<blockquote>
	<i>&quot;<b>Tip</b>: <u>A transaction should happen as quickly as possible</u> to reduce the likelihood that 
	the entities used by the transaction will change, requiring the transaction be retried. As much as 
	possible, prepare data outside of the transaction, then execute the transaction to perform datastore 
	operations that depend on a consistent state. The application should prepare keys for objects used 
	inside the transaction, then fetch the entities inside the transaction.&quot;</i>
</blockquote>
Regarding rollback, Slim3's Datastore automatically performs it when it's properly configured as described 
at the <a class="externalLink" href="https://sites.google.com/site/slim3appengine/slim3-datastore/installation">Slim3 Datastore installation instructions</a> page. And <tt>Slim3PlatformTransactionManger</tt> 
avoids duplicate rollback execution by gracefully discarding it.

<p></div><div class="section"><h4>Configuration guide<a name="Configuration_guide"></a></h4>
</p><ol style="list-style-type: decimal">
	<li>First Of all, the <b>issue about Spring's proxing on GAE/J</b>.<br />
		In order to use Spring's transaction support on GAE/J, Spring Transaction must be configured via 
		rather AspectJ than Spring AOP because, in simple words, Spring Transaction is basically built 
		upon around-advise AOP and Spring proxy does not work on GAE/J (For more info about it, please 
		refer to <a class="externalLink" href="https://gaeworkout.appspot.com/">gaeworkout.appspot.com</a>.) And how to 
		correctly configure Spring to use AspectJ for instantiating bean with injecting dependency too 
		requires the solid knowledge of Spring and AspectJ. Because of that, many folks believed that 
		Spring Transaction had not worked on GAE/J (without hack). (In this page, the only how-to for 
		configuring Slim3PlatformTransactionManger is provided (briefly, not in depth), and please be 
		advised that, for your own custom aspect (other than SlingOnG), you may encounter problem even 
		you configure the same kind way to define bean for your custom aspect due to something like what 
		in your classpath, AspectJ's aspectpath, whether your aspect needs to have dependency injected, 
		other factors like configuration for Spring's annotation support for related beans, and of 
		course Spring version.)
	</li>
	<li><b>Add dependency libraries</b> to your AppEngine web app project<br />
		Add the library binaries of Slim3, SlingOnG, and Spring as well as AppEngine SDK ones. For list of dependency 
		library, see <a href="dependencies.html">Dependencies page</a>.
		<ul>
			<li>To download SlingOnG
				<ul>
					<li>When you use auto-fashion build framework like Maven and others, see <a href="dependency-info.html">Dependency Information page</a>.<br />
						For released version, the artifact will be able to be downloaded from Maven central 
						repository.<br />
						For snapshot build, use Sonatype's Nexus snapshots repo:
						<blockquote>
							<tt>
								&lt;id&gt;sonatype-nexus-snapshots&lt;/id&gt;<br />
								&#160;&#160;&#160;&#160;
								&lt;name&gt;Sonatype Nexus Snapshots&lt;/name&gt;<br />
								&#160;&#160;&#160;&#160;
								&lt;url&gt;https://oss.sonatype.org/content/repositories/snapshots&lt;/url&gt;<br />
								&#160;&#160;&#160;&#160;
								&lt;releases&gt;&lt;enabled&gt;false&lt;/enabled&gt;&lt;/releases&gt;<br />
								&#160;&#160;&#160;&#160;
								&lt;snapshots&gt;&lt;enabled&gt;true&lt;/enabled&gt;&lt;/snapshots&gt;<br />
								&lt;/repository&gt;
							</tt>
						</blockquote>
					</li>
					<li>For manual download, the SlingOnG artifact can be downloaded from <a class="externalLink" href="https://oss.sonatype.org/content/groups/public/com/newmainsoftech/">Sonatype's Nexus public repo</a>
					</li>
				</ul>
			</li>
			<li>To download Slim3
				<ul>
					<li>For Maven, Slim3 artifacts can be downloaded from the Seasar Foundation repo.
						<blockquote>
							<tt>
								&lt;repository&gt;<br />
								&#160;&#160;&#160;&#160;&lt;name&gt;Seasar Foundation repo&lt;/name&gt;<br />
								&#160;&#160;&#160;&#160;&lt;id&gt;maven.seasar.org&lt;/id&gt;<br />
								&#160;&#160;&#160;&#160;&lt;url&gt;https://www.seasar.org/maven/maven2&lt;/url&gt;<br />
								&#160;&#160;&#160;&#160;&lt;snapshots&gt;<br />
								&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&lt;enabled&gt;true&lt;/enabled&gt;<br />
								&#160;&#160;&#160;&#160;&lt;/snapshots&gt;<br />
								&#160;&#160;&#160;&#160;&lt;releases&gt;<br />
								&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;
								&lt;updatePolicy&gt;never&lt;/updatePolicy&gt;<br />
								&#160;&#160;&#160;&#160;&lt;/releases&gt;<br />
								&lt;/repository&gt;<br />
							</tt>
						</blockquote>
					</li>
					<li>For manual download, the Slim3 artifact can be downloaded from <a class="externalLink" href="https://code.google.com/p/slim3/downloads/list">Slim3 Google code site</a>.
					</li>
				</ul>
			</li>
			<li>To download Spring components
				<ul>
					<li>Refer to the <a class="externalLink" href="http://blog.springsource.org/2009/12/02/obtaining-spring-3-artifacts-with-maven/">&quot;Obtaining Spring 3 Artifacts with Maven&quot;</a> springsource blog post by Mr. Keith Donald.
					</li>
					<li>For manual download, you may use the following sites. (For the difference, 
						please follow the link of the above blog post.):
						<ul>
							<li><a class="externalLink" href="https://repository.apache.org/index.html#welcome">Maven central repo site</a>
							</li>
							<li><a class="externalLink" href="http://ebr.springsource.com/repository/app/">springsource EBR repo site</a>
							</li>
						</ul>
					</li>
				</ul>
			</li>
		</ul>
	</li>
	<li><b>Configuration for Slim3's Datastore library</b><br />
		<ul>
			<li>Follows the <a class="externalLink" href="https://sites.google.com/site/slim3appengine/slim3-datastore/installation">Slim3 Datastore installation instructions</a> in the Slim3's web site.
			</li>
			<li>If the project of your AppEngine's web app is a Maven project, then 
				org.codehaus.mojo:build-helper-maven-plugin and org.codehaus.mojo:apt-maven-plugin plugins 
				(and org.slim3:slim3-gen artifact dependency of course) must be configured for annotation 
				processing for Slim3 Datastore.<br />
				You may refer to <a class="externalLink" href="https://code.google.com/p/spray/source/browse/trunk/slingong_test/pom.xml">pom.xml of SlingOnG_test module</a> as an example though the execution phases of those 
				plugins have been set to the test phase because the SlingOnG_test module is the module just 
				for testing SlingOnG module. 
			</li>
		</ul>
	</li>
	<li><b>Add spring-aspects.jar and slingong.jar to AspectJ's aspectpath</b>.
	</li>
	<li>Configuration in <b>Spring's application context</b> .xml file<br />
		You may take a look of <a class="externalLink" href="https://code.google.com/p/spray/source/browse/trunk/slingong_test/src/test/resources/com/newmainsoftech/spray/slingong/testContext2.xml"><tt>testContext2.xml</tt></a> as an example (although it is 
		for JUnit test with Spring's <tt>@ContextConfiguration</tt> annotation use.)
		<ul>
			<li>Add <tt>&lt;<b>context:annotation-config</b> /&gt;</tt> and <tt>&lt;<b>context:component-scan</b> 
				<b>base-package</b>=&quot;<i>package_of_your_component</i>..*&quot; /&gt;</tt>.<br />
				Replace the <i>package_of_your_component</i> part with actual package name of your 
				component.<br />
				(You may take a look at <a class="externalLink" href="http://swik.net/Spring/Interface21+Team+Blog/Spring+2.5%27s+Comprehensive+Annotation+Support/b1z6v">Spring 2.5's Comprehensive Annotation Support</a> SWiK blog post by Mr. Juergen Hoeller if you 
				need more information on the <tt>context</tt> tag, although it was written at Spring 
				ver 2.5 time.)
			</li>
			<li>Define a bean of <tt>AnnotationBeanConfigurerAspect</tt> aspect.
				<blockquote>
					<tt>
						&lt;<b>bean</b>&#160;id=&quot;annotationBeanConfigurerAspect&quot;<br />
						&#160;&#160;&#160;&#160;
						<b>class</b>=&quot;org.springframework.beans.factory.aspectj.<b>AnnotationBeanConfigurerAspect</b>&quot;<br />
						&#160;&#160;&#160;&#160;
						<b>factory-method=&quot;aspectOf&quot;</b> /&gt;
					</tt>
				</blockquote>
			</li>
			<li>Define a bean of <tt>Slim3PlatformTransactionManager</tt> class.
				<blockquote>
					<tt>
						&lt;<b>bean</b>&#160;id=&quot;txManager&quot;<br />
						&#160;&#160;&#160;&#160;
						<b>class</b>=&quot;com.newmainsoftech.spray.slingong.datastore.<b>Slim3PlatformTransactionManager</b>&quot; /&gt;
					</tt>
				</blockquote>
			</li>
			<li>Define a bean of <tt>AnnotationTransactionAspect</tt> aspect with injecting 
				<tt>Slim3PlatformTransactionManager</tt> bean defined at the previous step.				
				<blockquote>
					<tt>
						&lt;<b>bean</b>&#160;id=&quot;annotationTransactionAspect&quot; <br />
						&#160;&#160;&#160;&#160;
						<b>class</b>=&quot;org.springframework.transaction.aspectj.<b>AnnotationTransactionAspect</b>&quot;<br />
						&#160;&#160;&#160;&#160;
						<b>factory-method=&quot;aspectOf&quot;</b>&gt;<br />
						&#160;&#160;&#160;&#160;
						&lt;<b>property</b> 
							&#160;<b>name=&quot;transactionManager&quot;</b>
							&#160;<b>ref=&quot;txManager&quot;</b> /&gt;<br />
						&lt;/bean&gt;
					</tt>
				</blockquote>
			</li>
			<li>Define a bean of <tt>AnnotationAwareAspectJAutoProxyCreator</tt> class with 
				the dependencies of beans defined above steps:
				<blockquote>
					<tt>
						&lt;<b>bean</b> <br />
						&#160;&#160;&#160;&#160;
						class=&quot;org.springframework.aop.aspectj.annotation.<b>AnnotationAwareAspectJAutoProxyCreator</b>&quot;<br />
						&#160;&#160;&#160;&#160;
						<b>depends-on=&quot;annotationBeanConfigurerAspect,annotationTransactionAspect,annotationTransactionOnStaticMethodAspect</b>&quot;&gt;<br />
						&#160;&#160;&#160;&#160;
						&lt;property name=&quot;includePatterns&quot;&gt;<br />
						&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;
						&lt;list&gt;&lt;value&gt;nothing&lt;/value&gt;&lt;/list&gt;<br />
						&#160;&#160;&#160;&#160;
						&lt;/property&gt;<br />
						&lt;/bean&gt;
					</tt>
				</blockquote>
				This bean is a dummy bean in order to just force early instantiations of the beans defined 
				in the previous steps above.
			</li>
		</ul>
	</li>
	<li>Compile and test.
	</li>
</ol>

</div></div></div>

                  </div>
            </div>
          </div>

    <hr/>

    <footer>
            <div class="container-fluid">
              <div class="row span12">Copyright &copy;                    2011-2013
                        <a href="http://newmainsoftech.com">NewMain Softech</a>.
            All Rights Reserved.      
            
      </div>

        
        
                </div>
    </footer>
  </body>
</html>
